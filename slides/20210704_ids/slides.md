---
theme: default
background: https://source.unsplash.com/collection/94734566/1920x1080
class: text-center
canvasWidth: 1300
highlighter: shiki
info: |
  ## ID生成あれこれ2021
  ID生成まわりについて

  by kzmake
title: ID生成
---

# ID生成あれこれ2021

使われそうなIDについてあれこれまとめます

<!--
aaaaa
-->

---

# IDとは？

ある集合から特定のモノを一意に識別したりする際に利用する識別子。具体的には下記がありそう。

- メールアドレス
- 携帯番号
- マイナンバー
- 社員番号
- 集約やエンティティのID
- セッションID
- リクエストID
- アクセストークン
- URI(/URL/URN)

<!--
ドメインモデルの識別子やリクエストの識別子など一意なIDとして生成しなきゃいけない場面がよくあります。そのIDの生成について軽めにまとめていきます。
-->

---

# よく使われそうなID

- AUTO_INCREMENT
- 事前採番方式
- Hashids + 連番
- UUIDv1/v4
- ULID
- UUIDv6/v7

---


# IDを選択する観点

- 型
- サイズ
- ソート可能
- 速度
- タイムスタンプ
- ランダム性
- シーケンシャル

---

# 影響をあたえるもの: MySQL(InnoDB)の空間効率

MySQL(InnoDB)では B+ tree が利用されている。

ランダム性が強いとインデックスの空間効率が悪くなるらしい。
逆に、ソート可能であると効率はよくなる。

https://zenn.dev/j5ik2o/articles/a085ab3e3d0f197f6559

> 100万件以上扱う場合は、INSERT時間のペナルティが大きくなります

- http://kccoder.com/mysql/uuid-vs-int-insert-performance/
- https://qiita.com/sifue/items/c9192726bdce4b4a6dd7

---

# DBによるAUTO_INCREMENT

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
123
```

|                |                          |
| -------------- | ------------------------ |
| 型             | int64                    |
| サイズ         | -                        |
| ソート         | ○                        |
| 速度           | × (golang 3989625 ns/op) |
| URLセーフ      | ○                        |
| タイムスタンプ | なし                     |
| ランダム       | なし                     |
| シーケンシャル | AUTO_INCREMENTに従う     |

## 特徴

- 事後採番型のため、モデルIDの初期値未定義問題がよくおこる
    - MySQLのLAST_INSERT_IDやPostgreSQLで事前採番も可能
        - https://qiita.com/NAKANO_Akihito/items/44db44375a464c72606a
- DBのネットワークI/OやディスクI/Oのレイテンシを受ける
- SPoFになりやすい
- そのまま使うとIDがバレバレで推測が容易

</div>
<div>

## Layout
※64bit
```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              seq                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              seq                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>

---

# DBによるAUTO_INCREMENT + hashids: https://hashids.org/

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
XPjowja0
```

|                |                                              |
| -------------- | -------------------------------------------- |
| 型             | string                                       |
| サイズ         | -                                            |
| ソート         | ×                                            |
| 速度           | × (golang 4036252 ns/op) (hashids 869 ns/op) |
| URLセーフ      | ○                                            |
| タイムスタンプ | なし                                         |
| ランダム       | なし                                         |
| シーケンシャル | AUTO_INCREMENTに従う                         |

## 特徴

- DBによるAUTO_INCREMENTとほぼ同じ
- hashidsの特徴
    - 推測困難
    - ソルトやカスタムアルファベットを指定可能
    - 任意長の文字列を生成可能

</div>
<div>

## Layout
※64bit
```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              seq                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              seq                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>

---

# UUIDv4: https://datatracker.ietf.org/doc/html/rfc4122

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
031cba4b-cbfc-463f-afe8-a50af36f3eb3
```

|                |                                      |
| -------------- | ------------------------------------ |
| 型             | string                               |
| サイズ         | 128 bits (32 chars※ハイフンを除いて) |
| ソート         | ×                                    |
| 速度           | ◎ (golang 200 ns/op)                 |
| URLセーフ      | ○                                    |
| タイムスタンプ | なし                                 |
| ランダム       | 2^122(バリアント1の場合)             |
| シーケンシャル | なし                                 |

## 特徴

- 推測困難なため、アクセストークンやセッションIDとしても利用される
- まあ、ぶつからない
- ほぼ全ての言語で利用できる
- MySQL(InnoDB)での空間効率は良くないらしい

</div>
<div>

## Layout

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          random                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       random                  |0 1 0 0|         random        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|1 0|                          random                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          random                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>


---

# UUIDv1: https://datatracker.ietf.org/doc/html/rfc4122

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
ddb39472-ddba-11eb-8b44-149d9980a4d2
```

|                |                                               |
| -------------- | --------------------------------------------- |
| 型             | string                                        |
| サイズ         | 128 bits (32 chars※ハイフンを除いて)          |
| ソート         | ×(タイムスタンプの上位と下位が逆転してるから) |
| 速度           | ◎ (golang 157 ns/op)                          |
| URLセーフ      | ○                                             |
| タイムスタンプ | ○                                             |
| ランダム       | なし                                          |
| シーケンシャル | 2^16                                          |

## 特徴

- ほぼ全ての言語で利用できる
- MySQL(InnoDB)での空間効率は良くないらしい

</div>
<div>

## Layout

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          time_low                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       time_mid                |0 0 0 1|      time_high        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|clk_seq_hi_res |  clk_seq_low  |         node (0-1)            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         node (2-5)                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>

---

# ULID: https://github.com/ulid/spec

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>


```
01ARZ3NDEKTSV4RRFFQ69G5FAV
```

|                |                      |
| -------------- | -------------------- |
| 型             | string               |
| サイズ         | 128 bits (36 chars)  |
| ソート         | ○                    |
| 速度           | ◎ (golang 177 ns/op) |
| URLセーフ      | ○                    |
| タイムスタンプ | ミリ秒               |
| ランダム       | 2^80 ids per msec    |
| シーケンシャル | なし                 |

## 特徴

- Crockford's base32 を使っている
- UUIDとの128ビット互換性
- そこそこ様々な言語で利用できる

</div>
<div>

## Layout

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    32_bit_timestamp_ms_high                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   16_bit_timestamp_ms_low     |       16_bit_uint_random      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       32_bit_uint_random                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       32_bit_uint_random                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>


---


# xid: https://github.com/rs/xid

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
c3hkhd86n88o0jdjgatg
```

|                |                                   |
| -------------- | --------------------------------- |
| 型             | string                            |
| サイズ         | 96 bits (20 chars)                |
| ソート         | ○                                 |
| 速度           | ◎ (golang 96 ns/op)               |
| URLセーフ      | ○                                 |
| タイムスタンプ | 秒                                |
| ランダム       | 2^24 ids per sec per host/process |
| シーケンシャル | なし                              |

## 特徴

- [Mongo Object ID](https://docs.mongodb.com/manual/reference/method/ObjectId/) ベース
- そこそこな言語で利用できる
- Lock-free

</div>
<div>

## Layout

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      32_bit_timestamp_sec                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     24_bit_machine_identifier                 |  8_bit_pid_h  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| 8_bit_pid_low |             24_bit_uint_random                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>

---

# Snowflake: https://github.com/bwmarrin/snowflake

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
1412207541694230528
```

|                |                           |
| -------------- | ------------------------- |
| 型             | int64                     |
| サイズ         | 63 bits                   |
| ソート         | ◎                         |
| 速度           | ○ (golang 244.0 ns/op)    |
| URLセーフ      | ○                         |
| タイムスタンプ | ○                         |
| ランダム       | なし                      |
| シーケンシャル | 2^12 per msec per machine |


## 特徴

- [snowflake](https://blog.twitter.com/engineering/en_us/a/2010/announcing-snowflake)
- 分散ID採番器を想定
    - 2^10 machines

</div>
<div>

## Layout

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          32_bit_timestamp                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| 9_bit_timestamp |   10_bit_node_id  |     12_bit_seq_id     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>


---

# Sandflake: https://github.com/sony/sonyflake

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
05X7JEHZ190PR7A70000133R80
```

|                |                                      |
| -------------- | ------------------------------------ |
| 型             | string                               |
| サイズ         | 128 bits (32 chars※ハイフンを除いて) |
| ソート         | ○                                    |
| 速度           | ○ (golang 216 ns/op)                 |
| URLセーフ      | ○                                    |
| タイムスタンプ | ○                                    |
| ランダム       | 2^24 per msec per machine            |
| シーケンシャル | 2^24 per msec per machine            |


## 特徴

- [snowflake](https://blog.twitter.com/engineering/en_us/a/2010/announcing-snowflake) ベース
- 分散ID採番器を想定

</div>
<div>

## Layout

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       32_bit_timestamp_ms                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       16_bit_timestamp_ms     |     16_bit_worker_id_high     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     16_bit_worker_id_low      |       16_bit_seq_high         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| 8_bit_seq_low |                     24_bit_random             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>


---

# Sonyflake: https://github.com/sony/sonyflake

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
16779884
```

|                |                             |
| -------------- | --------------------------- |
| 型             | uint64                      |
| サイズ         | 63 bits                     |
| ソート         | ○                           |
| 速度           | × (golang 39303 ns/op)      |
| URLセーフ      | ○                           |
| タイムスタンプ | ○                           |
| ランダム       | なし                        |
| シーケンシャル | 2^8 per 10 msec per machine |


## 特徴

- [snowflake](https://blog.twitter.com/engineering/en_us/a/2010/announcing-snowflake) ベース
- 分散ID採番器を想定
    - 2^16 machines

</div>
<div>

## Layout

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          32_bit_time_10ms                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  7_bit_time |    8_bit_seq    |      16_bit_machine_id      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>

---



# Nanoid: https://github.com/matoous/go-nanoid

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
rN1FcPY7_rX5lJ-xHl0LW
```

|                |                      |
| -------------- | -------------------- |
| 型             | string               |
| サイズ         | 108 bits (21 chars)  |
| ソート         | ○                    |
| 速度           | ○ (golang 299 ns/op) |
| URLセーフ      | ×                    |
| タイムスタンプ | ○                    |
| ランダム       | 2^108                |
| シーケンシャル | なし                 |


## 特徴

- UUIDv4ぽいID
- いろいろな言語で利用できそう

</div>
<div>

## Layout

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             random                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             random                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             random                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         random        |
+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>

---


# KSUID: https://github.com/segmentio/ksuid

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
1uv0Ma3iQrWyQGmWjMYLDEik8BX
```

|                |                      |
| -------------- | -------------------- |
| 型             | string               |
| サイズ         | 160 bits (27 chars)  |
| ソート         | ○                    |
| 速度           | ○ (golang 359 ns/op) |
| URLセーフ      | ○                    |
| タイムスタンプ | ○                    |
| ランダム       | 2^128                |
| シーケンシャル | なし                 |

## 特徴

- [snowflake](https://blog.twitter.com/engineering/en_us/a/2010/announcing-snowflake) + UUIDv4
- base62 エンコード
- Collision-free, Coordination-free, Dependency-free
- 100年以上の寿命: 2014年3月5日~ のタイムスタンプで調整済み

</div>
<div>

## Layout

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        32_bit_timestamp                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            random                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            random                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            random                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            random                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>

---

# ShortUUID: https://github.com/segmentio/ksuid

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
AaUfaFQh9GxnsHBHKbjiLE
```

|                |                      |
| -------------- | -------------------- |
| 型             | string               |
| サイズ         | 128 bits (22 chars)  |
| ソート         | ×                    |
| 速度           | △ (golang 5553 ns/op) |
| URLセーフ      | ○                    |
| タイムスタンプ | ×                    |
| ランダム       | 2^122                |
| シーケンシャル | なし                 |

## 特徴

- UUIDv4
- base57 エンコード

</div>
<div>

## Layout

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          random                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       random                  |0 1 0 0|         random        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|1 0|                          random                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          random                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>

---

## 新しいUUID

- UUIDv6
- UUIDv7
- UUIDv8

---


# UUIDv6: [New UUID Formats](https://www.ietf.org/archive/id/draft-peabody-dispatch-new-uuid-format-01.html)

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
1ebddbad-db3a-6296-8000-8da19654df48
```

|                |                                      |
| -------------- | ------------------------------------ |
| 型             | string                               |
| サイズ         | 128 bits (32 chars※ハイフンを除いて) |
| ソート         | ○                                    |
| 速度           | ○ (golang 208 ns/op)                 |
| URLセーフ      | ○                                    |
| タイムスタンプ | ○                                    |
| ランダム       | なし                                 |
| シーケンシャル | 2^(タイムスタンプの余ったbit次第)    |

## 特徴

- ソート可能なUUIDv1にみえる

</div>
<div>

## Layout

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         32_bit_time_high                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         16_bit_time_mid       |0 1 1 0|   12_bit_time_low     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|var|       clk_seq             |             node              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             node                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>

---

# UUIDv7: [New UUID Formats](https://www.ietf.org/archive/id/draft-peabody-dispatch-new-uuid-format-01.html)

<div class="grid grid-cols-[650px,1fr,10%] gap-4">
<div>

```
060e348b-5c1b-7943-8000-c414add1c8d1
```

|                |                                          |
| -------------- | ---------------------------------------- |
| 型             | string                                   |
| サイズ         | 128 bits (32 chars※ハイフンを除いて)     |
| ソート         | ○                                        |
| 速度           | ○ (golang 207 ns/op)                     |
| URLセーフ      | ○                                        |
| タイムスタンプ | ○                                        |
| ランダム       | 2^32 + 2^(タイムスタンプの余ったbit次第) |
| シーケンシャル | 2^(タイムスタンプの余ったbit次第)        |

## 特徴

- ULIDっぽい
- タイムスタンプが 90bits もある
    - msec / usec / nsec まで表現できる
- ソート可能なUUID

</div>
<div>

## Layout

※ ナノ秒の例

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         32_bit_unixtime                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           16_bit_nsec         |0 1 1 1|    12_bit_nsec        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|var|       30_bit_nsec         |      seq      |    random     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            random                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

</div>
</div>

---

